---
export type Props = {
  src: string;
};
const { src } = Astro.props;
---

<custom-video data-src={src}></custom-video>

<script>
  class Video extends HTMLElement {
    video: HTMLVideoElement;

    constructor() {
      super();
      let shadowRoot = this.attachShadow({ mode: "open" });
      shadowRoot.innerHTML = `
      <video autoplay loop muted>
        Your browser can't play videos
      </video>
      <style>
        video {
          width: 100%;
        }
      </style>
      `;
    }

    connectedCallback() {
      let src = this.dataset.src;
      let video = this.shadowRoot!.querySelector("video");
      if (src && video) {
        video.src = src;
        this.video = video;
        video.addEventListener("contextmenu", (e) => e.preventDefault());
      }
    }

    disconnectedCallback() {
      this.video.removeEventListener("contextmenu", (e) => e.preventDefault());
    }
  }

  customElements.define("custom-video", Video);
</script>

<style>
  custom-video {
    margin: 2rem 0 1rem 0;
  }
</style>
